<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Character Sheet</title>
    <link rel="stylesheet" href="styles.css" />
    
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cpath fill='%238b2e2e' stroke='%23d4a574' stroke-width='3' stroke-linejoin='round' d='M32 4 L56 18 L56 46 L32 60 L8 46 L8 18 Z M32 4 L32 32 M32 32 L56 18 M32 32 L8 18 M32 32 L32 60 M32 32 L56 46 M32 32 L8 46'/%3E%3C/svg%3E"
    />
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap"
      rel="stylesheet"
    />
    
    <script src="script.js" defer></script>
  </head>
  <body>
    <div class="character-sheet">
      <div class="header">
        <h1>Character Sheet</h1>
        <a href="dm_screen.html" class="dm-screen-button">DM Screen</a>
        <div class="subtitle">Character</div>
      </div>

      <div class="sheet-section full-width">
      <div class="grid grid-4">
        <div class="field">
          <label class="field-label">Character Name</label>
          <input type="text" id="charName" placeholder="Enter name..." />
        </div>
        <div class="field">
          <label class="field-label">Class</label>
          <input type="text" id="charClass" placeholder="e.g., Fighter" />
        </div>
        <div class="field">
          <label class="field-label">Level</label>
          <input type="number" id="level" value="1" min="1" max="20" />
        </div>
        <div class="field">
          <label class="field-label">Subclass</label>
          <input type="text" id="charSubclass" placeholder="e.g., Champion" />
        </div>
      </div>

      <div class="grid grid-4">
        <div class="field">
          <label class="field-label">Race</label>
          <input type="text" id="race" placeholder="Race" />
        </div>
        <div class="field">
          <label class="field-label">Background</label>
          <input type="text" id="background" placeholder="Background" />
        </div>
        <div class="field">
          <label class="field-label">Alignment</label>
          <input
            type="text"
            id="alignment"
            placeholder="Click to set"
            readonly
            style="cursor: pointer"
          />
        </div>
        <div class="field">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 6px;
            "
          >
            <div style="display: flex; align-items: center; gap: 5px;">
              <label class="field-label" style="margin-bottom: 0">Experience</label>
              <span class="skill-info-btn" onclick="openXpTableModal()" style="width: 16px; height: 16px; font-size: 0.7rem; cursor: pointer;">?</span>
            </div>
            <button type="button" id="addExpBtn" class="mini-btn">+</button>
          </div>
          <input type="number" id="experience" value="0" />
        </div>
      </div>
      </div>

      <div class="sheet-section full-width">
      <h2 class="section-title" id="section-stats">Ability Scores, Saves & Skills</h2>
      <div style="text-align: center; margin-bottom: 20px">
        <button
          class="btn btn-secondary"
          onclick="openScoreModal()"
          style="font-size: 0.9rem; padding: 8px 16px"
        >
          Set Up Ability Scores
        </button>
      </div>

      <div class="stat-block">
        <div class="stat-card">
          <div class="stat">
            <div class="stat-name">Strength</div>
            <input type="number" class="stat-value" id="str" value="10" min="1" max="30"/>
            <div class="stat-modifier">
              <input type="text" id="strMod" value="+0" readonly style="width: 50px"/>
            </div>
          </div>
          <div class="stat-skills">
            <div class="skill-item" onclick="toggleSave('str')">
              <div class="skill-checkbox" id="saveCheck_str"><div class="checkmark">✓</div></div>
              <div class="skill-name">Saving Throw</div>
              <span class="skill-info-btn" onclick="showSkillInfo('save_str', event)">?</span>
              <div class="skill-mod" id="saveMod_str">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('athletics')">
              <div class="skill-checkbox" id="skillCheck_athletics"><div class="checkmark">✓</div></div>
              <div class="skill-name">Athletics</div>
              <span class="skill-info-btn" onclick="showSkillInfo('athletics', event)">?</span>
              <div class="skill-mod" id="skillMod_athletics">+0</div>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat">
            <div class="stat-name">Dexterity</div>
            <input type="number" class="stat-value" id="dex" value="10" min="1" max="30"/>
            <div class="stat-modifier">
              <input type="text" id="dexMod" value="+0" readonly style="width: 50px"/>
            </div>
          </div>
          <div class="stat-skills">
            <div class="skill-item" onclick="toggleSave('dex')">
              <div class="skill-checkbox" id="saveCheck_dex"><div class="checkmark">✓</div></div>
              <div class="skill-name">Saving Throw</div>
              <span class="skill-info-btn" onclick="showSkillInfo('save_dex', event)">?</span>
              <div class="skill-mod" id="saveMod_dex">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('acrobatics')">
              <div class="skill-checkbox" id="skillCheck_acrobatics"><div class="checkmark">✓</div></div>
              <div class="skill-name">Acrobatics</div>
              <span class="skill-info-btn" onclick="showSkillInfo('acrobatics', event)">?</span>
              <div class="skill-mod" id="skillMod_acrobatics">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('sleight_of_hand')">
              <div class="skill-checkbox" id="skillCheck_sleight_of_hand"><div class="checkmark">✓</div></div>
              <div class="skill-name">Sleight of Hand</div>
              <span class="skill-info-btn" onclick="showSkillInfo('sleight_of_hand', event)">?</span>
              <div class="skill-mod" id="skillMod_sleight_of_hand">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('stealth')">
              <div class="skill-checkbox" id="skillCheck_stealth"><div class="checkmark">✓</div></div>
              <div class="skill-name">Stealth</div>
              <span class="skill-info-btn" onclick="showSkillInfo('stealth', event)">?</span>
              <div class="skill-mod" id="skillMod_stealth">+0</div>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat">
            <div class="stat-name">Constitution</div>
            <input type="number" class="stat-value" id="con" value="10" min="1" max="30"/>
            <div class="stat-modifier">
              <input type="text" id="conMod" value="+0" readonly style="width: 50px"/>
            </div>
          </div>
          <div class="stat-skills">
            <div class="skill-item" onclick="toggleSave('con')">
              <div class="skill-checkbox" id="saveCheck_con"><div class="checkmark">✓</div></div>
              <div class="skill-name">Saving Throw</div>
              <span class="skill-info-btn" onclick="showSkillInfo('save_con', event)">?</span>
              <div class="skill-mod" id="saveMod_con">+0</div>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat">
            <div class="stat-name">Intelligence</div>
            <input type="number" class="stat-value" id="int" value="10" min="1" max="30"/>
            <div class="stat-modifier">
              <input type="text" id="intMod" value="+0" readonly style="width: 50px"/>
            </div>
          </div>
          <div class="stat-skills">
            <div class="skill-item" onclick="toggleSave('int')">
              <div class="skill-checkbox" id="saveCheck_int"><div class="checkmark">✓</div></div>
              <div class="skill-name">Saving Throw</div>
              <span class="skill-info-btn" onclick="showSkillInfo('save_int', event)">?</span>
              <div class="skill-mod" id="saveMod_int">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('arcana')">
              <div class="skill-checkbox" id="skillCheck_arcana"><div class="checkmark">✓</div></div>
              <div class="skill-name">Arcana</div>
              <span class="skill-info-btn" onclick="showSkillInfo('arcana', event)">?</span>
              <div class="skill-mod" id="skillMod_arcana">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('history')">
              <div class="skill-checkbox" id="skillCheck_history"><div class="checkmark">✓</div></div>
              <div class="skill-name">History</div>
              <span class="skill-info-btn" onclick="showSkillInfo('history', event)">?</span>
              <div class="skill-mod" id="skillMod_history">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('investigation')">
              <div class="skill-checkbox" id="skillCheck_investigation"><div class="checkmark">✓</div></div>
              <div class="skill-name">Investigation</div>
              <span class="skill-info-btn" onclick="showSkillInfo('investigation', event)">?</span>
              <div class="skill-mod" id="skillMod_investigation">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('nature')">
              <div class="skill-checkbox" id="skillCheck_nature"><div class="checkmark">✓</div></div>
              <div class="skill-name">Nature</div>
              <span class="skill-info-btn" onclick="showSkillInfo('nature', event)">?</span>
              <div class="skill-mod" id="skillMod_nature">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('religion')">
              <div class="skill-checkbox" id="skillCheck_religion"><div class="checkmark">✓</div></div>
              <div class="skill-name">Religion</div>
              <span class="skill-info-btn" onclick="showSkillInfo('religion', event)">?</span>
              <div class="skill-mod" id="skillMod_religion">+0</div>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat">
            <div class="stat-name">Wisdom</div>
            <input type="number" class="stat-value" id="wis" value="10" min="1" max="30"/>
            <div class="stat-modifier">
              <input type="text" id="wisMod" value="+0" readonly style="width: 50px"/>
            </div>
          </div>
          <div class="stat-skills">
            <div class="skill-item" onclick="toggleSave('wis')">
              <div class="skill-checkbox" id="saveCheck_wis"><div class="checkmark">✓</div></div>
              <div class="skill-name">Saving Throw</div>
              <span class="skill-info-btn" onclick="showSkillInfo('save_wis', event)">?</span>
              <div class="skill-mod" id="saveMod_wis">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('animal_handling')">
              <div class="skill-checkbox" id="skillCheck_animal_handling"><div class="checkmark">✓</div></div>
              <div class="skill-name">Animal Handling</div>
              <span class="skill-info-btn" onclick="showSkillInfo('animal_handling', event)">?</span>
              <div class="skill-mod" id="skillMod_animal_handling">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('insight')">
              <div class="skill-checkbox" id="skillCheck_insight"><div class="checkmark">✓</div></div>
              <div class="skill-name">Insight</div>
              <span class="skill-info-btn" onclick="showSkillInfo('insight', event)">?</span>
              <div class="skill-mod" id="skillMod_insight">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('medicine')">
              <div class="skill-checkbox" id="skillCheck_medicine"><div class="checkmark">✓</div></div>
              <div class="skill-name">Medicine</div>
              <span class="skill-info-btn" onclick="showSkillInfo('medicine', event)">?</span>
              <div class="skill-mod" id="skillMod_medicine">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('perception')">
              <div class="skill-checkbox" id="skillCheck_perception"><div class="checkmark">✓</div></div>
              <div class="skill-name">Perception</div>
              <span class="skill-info-btn" onclick="showSkillInfo('perception', event)">?</span>
              <div class="skill-mod" id="skillMod_perception">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('survival')">
              <div class="skill-checkbox" id="skillCheck_survival"><div class="checkmark">✓</div></div>
              <div class="skill-name">Survival</div>
              <span class="skill-info-btn" onclick="showSkillInfo('survival', event)">?</span>
              <div class="skill-mod" id="skillMod_survival">+0</div>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat">
            <div class="stat-name">Charisma</div>
            <input type="number" class="stat-value" id="cha" value="10" min="1" max="30"/>
            <div class="stat-modifier">
              <input type="text" id="chaMod" value="+0" readonly style="width: 50px"/>
            </div>
          </div>
          <div class="stat-skills">
            <div class="skill-item" onclick="toggleSave('cha')">
              <div class="skill-checkbox" id="saveCheck_cha"><div class="checkmark">✓</div></div>
              <div class="skill-name">Saving Throw</div>
              <span class="skill-info-btn" onclick="showSkillInfo('save_cha', event)">?</span>
              <div class="skill-mod" id="saveMod_cha">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('deception')">
              <div class="skill-checkbox" id="skillCheck_deception"><div class="checkmark">✓</div></div>
              <div class="skill-name">Deception</div>
              <span class="skill-info-btn" onclick="showSkillInfo('deception', event)">?</span>
              <div class="skill-mod" id="skillMod_deception">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('intimidation')">
              <div class="skill-checkbox" id="skillCheck_intimidation"><div class="checkmark">✓</div></div>
              <div class="skill-name">Intimidation</div>
              <span class="skill-info-btn" onclick="showSkillInfo('intimidation', event)">?</span>
              <div class="skill-mod" id="skillMod_intimidation">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('performance')">
              <div class="skill-checkbox" id="skillCheck_performance"><div class="checkmark">✓</div></div>
              <div class="skill-name">Performance</div>
              <span class="skill-info-btn" onclick="showSkillInfo('performance', event)">?</span>
              <div class="skill-mod" id="skillMod_performance">+0</div>
            </div>
            <div class="skill-item" onclick="toggleSkill('persuasion')">
              <div class="skill-checkbox" id="skillCheck_persuasion"><div class="checkmark">✓</div></div>
              <div class="skill-name">Persuasion</div>
              <span class="skill-info-btn" onclick="showSkillInfo('persuasion', event)">?</span>
              <div class="skill-mod" id="skillMod_persuasion">+0</div>
            </div>
          </div>
        </div>
      </div>
      </div>

      <div class="sheet-section">
      <h2 class="section-title" id="section-hp">Hit Points & Death Saves</h2>
      <div class="hp-bar-container">
        <div class="hp-fill-current" id="hpBarCurrent"></div>
        <div class="hp-fill-temp" id="hpBarTemp"></div>
        <div class="hp-overlay-text">
          <span id="hpTextDisplay">0</span> /
          <span id="maxHpTextDisplay">0</span>
        </div>
      </div>
      <div class="hp-death-grid">
        <div class="combat-stat">
          <div class="combat-stat-label">Current HP</div>
          <div class="hp-controls">
            <button class="hp-btn" onclick="adjustHP(-1)">-</button>
            <input type="number" class="combat-stat-value" id="hp" value="10" style="width: 60px"/>
            <button class="hp-btn" onclick="adjustHP(1)">+</button>
          </div>
        </div>
        <div class="combat-stat">
          <div class="combat-stat-label">Max HP</div>
          <input type="number" class="combat-stat-value" id="maxHp" value="10"/>
        </div>
        <div class="combat-stat">
          <div class="combat-stat-label">Temp HP</div>
          <div class="hp-controls">
            <button class="hp-btn" onclick="adjustTempHP(-1)">-</button>
            <input type="number" class="combat-stat-value" id="tempHp" value="0" style="width: 60px"/>
            <button class="hp-btn" onclick="adjustTempHP(1)">+</button>
          </div>
        </div>
        <div class="combat-stat">
          <div class="combat-stat-label">Hit Dice</div>
          <input type="text" class="combat-stat-value" id="hitDice" placeholder="1d8" style="font-size: 1.5rem"/>
        </div>
        <div class="death-saves-box">
          <div class="death-saves-label">Death Saves</div>
          <div class="death-saves-content">
            <div class="death-save-row">
              <span class="save-label">Successes:</span>
              <div class="death-save-checkboxes">
                <div class="death-save-check" onclick="toggleDeathSave('success', 0)" id="deathSuccess0"></div>
                <div class="death-save-check" onclick="toggleDeathSave('success', 1)" id="deathSuccess1"></div>
                <div class="death-save-check" onclick="toggleDeathSave('success', 2)" id="deathSuccess2"></div>
              </div>
            </div>
            <div class="death-save-row">
              <span class="save-label">Failures:</span>
              <div class="death-save-checkboxes">
                <div class="death-save-check" onclick="toggleDeathSave('failure', 0)" id="deathFailure0"></div>
                <div class="death-save-check" onclick="toggleDeathSave('failure', 1)" id="deathFailure1"></div>
                <div class="death-save-check" onclick="toggleDeathSave('failure', 2)" id="deathFailure2"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>

      <div class="sheet-section">
      <h2 class="section-title" id="section-combat">Combat Stats</h2>
      <div class="combat-stats">
        <div class="combat-stat">
          <div class="combat-stat-label">Armor Class</div>
          <input type="number" id="baseAC" value="10" />
          <div style="display: flex; align-items: center; justify-content: center; gap: 6px; margin-top: 8px;">
            <input type="checkbox" id="shieldEquipped" onchange="calculateTotalAC()" style="width: 14px; height: 14px; cursor: pointer"/>
            <label for="shieldEquipped" style="font-size: 0.7rem; font-family: 'Cinzel', serif; color: var(--ink-light); cursor: pointer">Shield (+2)</label>
          </div>
        </div>
        <div class="combat-stat">
          <div class="combat-stat-label">Initiative</div>
          <input type="text" class="combat-stat-value" id="initiative" value="+0" readonly/>
        </div>
        <div class="combat-stat">
          <div class="combat-stat-label">Speed</div>
          <input type="number" class="combat-stat-value" id="speed" value="30"/>
        </div>
        <div class="combat-stat">
          <div class="combat-stat-label">Size</div>
          <div style="display: flex; gap: 4px; align-items: center; justify-content: center;">
            <select id="charSize" class="combat-stat-value" style="font-size: 1rem; width: auto; padding: 0">
              <option value="Tiny">Tiny</option>
              <option value="Small">Small</option>
              <option value="Medium" selected>Med</option>
              <option value="Large">Large</option>
              <option value="Huge">Huge</option>
              <option value="Gargantuan">Garg</option>
            </select>
            <div style="display: flex; align-items: center">
              <input type="number" id="sizeFt" value="5" style="width: 40px; font-size: 1.5rem"/>
              <span style="font-family: 'Cinzel', serif; font-size: 0.8rem; color: var(--red-dark);">ft</span>
            </div>
          </div>
        </div>
        <div class="combat-stat">
          <div class="combat-stat-label">Proficiency Bonus</div>
          <input type="number" class="combat-stat-value" id="profBonus" value="2"/>
        </div>
      </div>

      <div class="grid grid-3">
        <div class="field">
          <label class="field-label">Armor Training</label>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; padding-left: 8px;">
            <div style="display: flex; align-items: center; gap: 8px">
              <input type="checkbox" id="armorLight" style="width: 16px; height: 16px; cursor: pointer"/>
              <span>Light</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px">
              <input type="checkbox" id="armorMedium" style="width: 16px; height: 16px; cursor: pointer"/>
              <span>Medium</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px">
              <input type="checkbox" id="armorHeavy" style="width: 16px; height: 16px; cursor: pointer"/>
              <span>Heavy</span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px">
              <input type="checkbox" id="armorShield" style="width: 16px; height: 16px; cursor: pointer"/>
              <span>Shield</span>
            </div>
          </div>
        </div>
        <div class="field">
          <label class="field-label">Weapon Proficiency</label>
          <div id="weaponProfsSelector">
            <input type="hidden" id="weaponProfs" onchange="renderWeaponTags()" />
            <div class="tag-display" id="weaponProfsDisplay" onclick="openWeaponProfModal()">
              <span style="color: var(--ink-light); font-style: italic; font-size: 0.9rem;">Click to select...</span>
            </div>
          </div>
          <textarea id="weaponProfsText" class="weapon-profs-text" style="display:none;" placeholder="e.g. Simple Weapons, Longswords..."></textarea>
        </div>
        <div class="field">
          <label class="field-label">Tool Proficiency</label>
          <textarea id="toolProfs" placeholder="e.g. Thieves' Tools, Lute..." style="min-height: 60px"></textarea>
        </div>
        <div class="combat-stat" onclick="openConditionModal()" style="cursor: pointer; grid-column: 1 / -1; height: auto; min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
          <div class="combat-stat-label">Conditions</div>
          <input type="hidden" id="activeConditionsInput" onchange="renderConditionTags()"/>
          <div id="conditionsDisplay" style="font-size: 1.1rem; color: var(--red-dark); padding: 8px 16px; font-weight: bold; font-family: 'Crimson Text', serif; font-style: italic; white-space: normal; line-height: 1.6; text-align: center;">
            None
          </div>
        </div>
      </div>
      </div>

      <div class="sheet-section">
      <h2 class="section-title" id="section-attacks">
        Weapon Attacks
        <span class="skill-info-btn" onclick="openMasteryModal()" style="width: 22px; height: 22px; font-size: 0.9rem; margin-left: 8px">?</span>
      </h2>
      <div class="grid">
        <div id="weapon-list" class="vertical-list"></div>
        <button class="add-feature-btn" onclick="addWeapon()">+ Add Weapon</button>
      </div>
      </div>

      <div class="sheet-section">
      <h2 class="section-title" id="section-actions">Action Economy</h2>
      <div class="grid grid-3">
        <div>
          <h3 class="section-title" style="font-size: 1.1rem; margin: 0 0 10px 0; border-bottom: none; padding-bottom: 0;">Actions</h3>
          <div id="actionsContainer"></div>
          <button class="add-feature-btn" onclick="addFeatureItem('actionsContainer')">+ Add Action</button>
        </div>
        <div>
          <h3 class="section-title" style="font-size: 1.1rem; margin: 0 0 10px 0; border-bottom: none; padding-bottom: 0;">Bonus Actions</h3>
          <div id="bonusActionsContainer"></div>
          <button class="add-feature-btn" onclick="addFeatureItem('bonusActionsContainer')">+ Add Bonus Action</button>
        </div>
        <div>
          <h3 class="section-title" style="font-size: 1.1rem; margin: 0 0 10px 0; border-bottom: none; padding-bottom: 0;">Reactions</h3>
          <div id="reactionsContainer"></div>
          <button class="add-feature-btn" onclick="addFeatureItem('reactionsContainer')">+ Add Reaction</button>
        </div>
      </div>
      </div>

      <div class="sheet-section full-width">
      <h2 class="section-title" id="section-extra">Extra</h2>
      <div class="tabs">
        <div class="tab active" onclick="switchTab('class-features')">Class Features</div>
        <div class="tab" onclick="switchTab('race-features')">Race Features</div>
        <div class="tab" onclick="switchTab('background-features')">Background Features</div>
        <div class="tab" onclick="switchTab('feats')">Feats</div>
        <div class="tab" onclick="switchTab('equipment')">Equipment & Inventory</div>
        <div class="tab" onclick="switchTab('spells')">Spells</div>
        <div class="tab" onclick="switchTab('notes')">Notes</div>
      </div>

      <div class="tab-content active" id="class-features">
        <div id="classFeaturesContainer"></div>
        <button class="add-feature-btn" onclick="addFeatureItem('classFeaturesContainer')">+ Add Feature</button>
      </div>

      <div class="tab-content" id="race-features">
        <div id="raceFeaturesContainer"></div>
        <button class="add-feature-btn" onclick="addFeatureItem('raceFeaturesContainer')">+ Add Feature</button>
      </div>

      <div class="tab-content" id="background-features">
        <div id="backgroundFeaturesContainer"></div>
        <button class="add-feature-btn" onclick="addFeatureItem('backgroundFeaturesContainer')">+ Add Feature</button>
      </div>

      <div class="tab-content" id="feats">
        <div id="featsContainer"></div>
        <button class="add-feature-btn" onclick="addFeatureItem('featsContainer')">+ Add Feat</button>
      </div>

      <div class="tab-content" id="equipment">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <h3 style="font-family: 'Cinzel', serif; font-size: 1rem; color: var(--red-dark); margin: 0;">Currency</h3>
          <div style="display: flex; gap: 5px;">
            <button class="btn btn-secondary" onclick="openCurrencyModal()" style="padding: 4px 10px; font-size: 0.8rem;">Exchange Rates</button>
            <button class="btn btn-secondary" onclick="openSplitMoneyModal()" style="padding: 4px 10px; font-size: 0.8rem;">Split Loot</button>
            <button class="btn btn-secondary" onclick="openManageMoneyModal()" style="padding: 4px 10px; font-size: 0.8rem;">Add/Spend</button>
          </div>
        </div>
        <div class="grid grid-3" style="margin-bottom: 16px">
          <div class="field"><label class="field-label">Copper</label><input type="number" id="cp" value="0" /></div>
          <div class="field"><label class="field-label">Silver</label><input type="number" id="sp" value="0" /></div>
          <div class="field"><label class="field-label">Electrum</label><input type="number" id="ep" value="0" /></div>
          <div class="field"><label class="field-label">Gold</label><input type="number" id="gp" value="0" /></div>
          <div class="field"><label class="field-label">Platinum</label><input type="number" id="pp" value="0" /></div>
        </div>

        <h3 class="section-title">Equipped Gear</h3>
        <div class="inventory-header">
          <span></span>
          <span style="font-size: 0.7rem; text-align: center">Equip</span>
          <span>Item Name</span>
          <span style="text-align: center">Qty</span>
          <span style="text-align: center">Lbs</span>
          <span style="text-align: center">Info</span>
          <span></span>
        </div>
        
        <div id="equippedList" class="inventory-list" style="min-height: 60px; border: 2px dashed var(--gold-dark); border-radius: 6px; padding: 8px; margin-bottom: 24px; background: rgba(255, 255, 255, 0.3);"></div>

        <h3 class="section-title">Backpack / Inventory</h3>
        <div class="inventory-header">
          <span></span>
          <span style="font-size: 0.7rem; text-align: center">Equip</span>
          <span>Item Name</span>
          <span style="text-align: center">Qty</span>
          <span style="text-align: center">Lbs</span>
          <span style="text-align: center">Info</span>
          <span></span>
        </div>
        
        <div id="inventoryList" class="inventory-list" style="min-height: 60px"></div>
        <div style="display: flex; gap: 10px;">
          <button class="add-feature-btn" onclick="addInventoryItem()">+ Add Custom</button>
          <button id="btn-search-items-zip" class="add-feature-btn" onclick="openItemSearch()" style="display: none;">Search Items</button>
        </div>

        <div class="total-weight-box" style="display: flex; flex-direction: column; gap: 4px; align-items: flex-end;">
          <div>Carrying Capacity: <span id="totalWeightVal">0</span> / <span id="maxWeightVal">150</span> lbs</div>
          <div style="font-size: 0.8rem; font-style: italic; opacity: 0.8">Max Drag/Lift: <span id="maxDragVal">300</span> lbs</div>
        </div>

        <div class="attunement-section">
          <h3 class="section-title">Magical Attunement</h3>
          <div class="attunement-grid">
            <div class="attunement-slot"><input type="text" id="attune1" placeholder="Empty Slot" style="text-align: center; font-weight: bold"/></div>
            <div class="attunement-slot"><input type="text" id="attune2" placeholder="Empty Slot" style="text-align: center; font-weight: bold"/></div>
            <div class="attunement-slot"><input type="text" id="attune3" placeholder="Empty Slot" style="text-align: center; font-weight: bold"/></div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="spells">
        <div class="grid grid-2" style="margin-bottom: 16px">
          <div class="field">
            <label class="field-label">Spellcasting Ability</label>
            <select id="spellAbility">
              <option value="int">Intelligence</option>
              <option value="wis">Wisdom</option>
              <option value="cha">Charisma</option>
            </select>
          </div>
          <div class="field"><label class="field-label">Spell Save DC</label><input type="text" id="spellDC" value="13" readonly /></div>
          <div class="field"><label class="field-label">Spell Modifier</label><input type="number" id="spellAttackMod" placeholder="+0" /></div>
          <div class="field"><label class="field-label">Spell Attack Bonus</label><input type="number" id="spellAttackBonus" placeholder="+0" /></div>
        </div>

        <h3 class="section-title">Spell Slots</h3>
        <div id="spellSlotsContainer"></div>
        <button class="add-feature-btn" onclick="addNewSpellLevel()">+ Add Spell Level</button>
        <div style="margin-top: 24px"></div>

        <h3 class="section-title">Cantrips (Level 0)</h3>
        <div class="spell-list-header">
          <span></span><span></span><span>Lvl</span><span>Name</span><span>Time</span><span>Range</span> <span title="Ritual">R</span><span title="Concentration">C</span><span title="Material">M</span><span></span><span></span>
        </div>
        <div id="cantripList"></div>
        <div style="display: flex; gap: 10px;">
            <button class="add-feature-btn" onclick="addSpellRow('cantripList', 0)">+ Add Custom</button>
            <button id="btn-search-cantrips-zip" class="add-feature-btn" onclick="openSpellSearch('cantripList', 'cantrip')" style="display: none;">Search Cantrips</button>
        </div>

        <h3 class="section-title" style="margin-top: 24px">Prepared Spells</h3>
        <div class="spell-list-header">
          <span></span><span>Prep</span><span>Lvl</span><span>Name</span><span>Time</span><span>Range</span> <span title="Ritual">R</span><span title="Concentration">C</span><span title="Material">M</span><span></span><span></span>
        </div>
        <div id="preparedSpellsList" class="spell-list-container" style="min-height: 40px; border: 1px dashed var(--gold); border-radius: 4px; padding: 4px;"></div>

        <h3 class="section-title" style="margin-top: 24px">Known Spells</h3>
        <div class="spell-list-header">
          <span></span><span>Prep</span><span>Lvl</span><span>Name</span><span>Time</span><span>Range</span> <span title="Ritual">R</span><span title="Concentration">C</span><span title="Material">M</span><span></span><span></span>
        </div>
        <div id="spellList" class="spell-list-container"></div>
        <div style="display: flex; gap: 10px;">
            <button class="add-feature-btn" onclick="addSpellRow('spellList', 1)">+ Add Custom</button>
            <button id="btn-search-spells-zip" class="add-feature-btn" onclick="openSpellSearch('spellList', 'leveled')" style="display: none;">Search Spells</button>
        </div>
      </div>
      </div>

      <div class="tab-content" id="notes">
        <div class="vertical-list">
          <div class="field"><label class="field-label">Languages Spoken</label><textarea id="languages" placeholder="Common, Elvish..." style="min-height: 60px"></textarea></div>
          <div class="field"><label class="field-label">Personality Traits</label><textarea id="personality" placeholder="Describe your character..."></textarea></div>
          <div class="field"><label class="field-label">Ideals</label><textarea id="ideals" placeholder="Beliefs..."></textarea></div>
          <div class="field"><label class="field-label">Bonds</label><textarea id="bonds" placeholder="Connections..."></textarea></div>
          <div class="field"><label class="field-label">Flaws</label><textarea id="flaws" placeholder="Weaknesses..."></textarea></div>
          <div class="field"><label class="field-label">Additional Notes</label><textarea id="notes" placeholder="Other info..."></textarea></div>
        </div>
      </div>

      <div class="sheet-actions">
        <button class="btn btn-secondary" onclick="openThemeModal()">Select Theme</button>
        <button class="btn btn-secondary" onclick="downloadJSON()">Save JSON</button>
        <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">Load JSON</button>
        <input type="file" id="fileInput" accept=".json" style="display: none" onchange="loadJSON(this)" />
        <button class="btn btn-secondary" onclick="openLastSavedModal()">Last Saved Data</button>
        <button class="btn btn-danger" onclick="resetSheet()">Reset Sheet</button>
      </div>
    </div>

    <div id="infoModal" class="info-modal-overlay" onclick="closeInfoModal(event)">
      <div class="info-modal-content">
        <button class="close-modal-btn" onclick="document.getElementById('infoModal').style.display = 'none'">&times;</button>
        <h3 id="infoModalTitle" class="info-modal-title">Title</h3>
        <div id="infoModalText" class="info-modal-text">Text goes here...</div>
      </div>
    </div>

    <div id="scoreModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 500px">
        <button class="close-modal-btn" onclick="closeScoreModal()">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Ability Score Generator</h3>
        <div class="score-modal-tabs">
          <div class="score-tab active" onclick="switchScoreTab('standard')">Standard Array</div>
          <div class="score-tab" onclick="switchScoreTab('pointbuy')">Point Buy</div>
        </div>
        <div id="tab-standard" class="score-method-container active">
          <p style="text-align: center; font-style: italic; margin-bottom: 15px; font-size: 0.9rem;">Assign each number once: 15, 14, 13, 12, 10, 8</p>
          <div class="sa-grid">
            <div class="sa-item"><label class="field-label">Strength</label><select id="sa_str" class="sa-select" onchange="updateStandardArrayOptions()"><option value="">—</option><option value="15">15</option><option value="14">14</option><option value="13">13</option><option value="12">12</option><option value="10">10</option><option value="8">8</option></select></div>
            <div class="sa-item"><label class="field-label">Dexterity</label><select id="sa_dex" class="sa-select" onchange="updateStandardArrayOptions()"><option value="">—</option><option value="15">15</option><option value="14">14</option><option value="13">13</option><option value="12">12</option><option value="10">10</option><option value="8">8</option></select></div>
            <div class="sa-item"><label class="field-label">Constitution</label><select id="sa_con" class="sa-select" onchange="updateStandardArrayOptions()"><option value="">—</option><option value="15">15</option><option value="14">14</option><option value="13">13</option><option value="12">12</option><option value="10">10</option><option value="8">8</option></select></div>
            <div class="sa-item"><label class="field-label">Intelligence</label><select id="sa_int" class="sa-select" onchange="updateStandardArrayOptions()"><option value="">—</option><option value="15">15</option><option value="14">14</option><option value="13">13</option><option value="12">12</option><option value="10">10</option><option value="8">8</option></select></div>
            <div class="sa-item"><label class="field-label">Wisdom</label><select id="sa_wis" class="sa-select" onchange="updateStandardArrayOptions()"><option value="">—</option><option value="15">15</option><option value="14">14</option><option value="13">13</option><option value="12">12</option><option value="10">10</option><option value="8">8</option></select></div>
            <div class="sa-item"><label class="field-label">Charisma</label><select id="sa_cha" class="sa-select" onchange="updateStandardArrayOptions()"><option value="">—</option><option value="15">15</option><option value="14">14</option><option value="13">13</option><option value="12">12</option><option value="10">10</option><option value="8">8</option></select></div>
          </div>
          <div style="margin-top: 20px; text-align: center"><button class="btn" onclick="applyStandardArray()">Apply Standard Array</button></div>
        </div>
        <div id="tab-pointbuy" class="score-method-container">
          <div class="point-buy-header">Remaining Points: <span id="pb-remaining" style="font-weight: bold; font-size: 1.4rem">27</span> / 27</div>
          <div id="pb-rows-container"></div>
          <div style="margin-top: 20px; text-align: center"><button class="btn" onclick="applyPointBuy()">Apply Point Buy</button></div>
        </div>
      </div>
    </div>

    <div id="weaponProfModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 600px">
        <button class="close-modal-btn" onclick="closeWeaponProfModal()">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Weapon Proficiencies</h3>
        <details style="margin-bottom: 15px">
          <summary style="cursor: pointer; font-family: 'Cinzel', serif; color: var(--gold-dark);">View Weapon Property Rules</summary>
          <div class="ref-box">
            <span class="ref-title">Ammunition</span> You need ammo to fire. Drawing it is part of the attack. Recover half after battle.
            <span class="ref-title">Finesse</span> Use STR or DEX for attack and damage. <span class="ref-title">Heavy</span> Disadvantage if Small (unless STR/DEX req met).
            <span class="ref-title">Light</span> Allows Bonus Action attack with another Light weapon. <span class="ref-title">Loading</span> Fire only one shot per Action/Reaction/Bonus Action.
            <span class="ref-title">Range</span> Normal/Long range. Disadvantage between normal and long. <span class="ref-title">Reach</span> Adds 5 feet to reach. <span class="ref-title">Thrown</span> Can be thrown. Use same ability mod as melee.
            <span class="ref-title">Two-Handed</span> Requires two hands. <span class="ref-title">Versatile</span> Can be used with one or two hands (different damage).
          </div>
        </details>
        <div class="checklist-grid" id="weaponChecklist"></div>
        <div style="text-align: center; margin-top: 16px"><button class="btn" onclick="saveWeaponProfsSelection()">Done</button></div>
      </div>
    </div>

    <div id="currencyModal" class="info-modal-overlay" onclick="closeCurrencyModal(event)">
      <div class="info-modal-content">
        <button class="close-modal-btn" onclick="document.getElementById('currencyModal').style.display = 'none'">&times;</button>
        <h3 class="info-modal-title">Currency Exchange</h3>
        <div class="info-modal-text">
          <table class="currency-table">
            <thead><tr><th>Currency</th><th>Value (Gold)</th><th>Exchange</th></tr></thead>
            <tbody>
              <tr><td><strong>Copper (cp)</strong></td><td>1/100 gp</td><td>10 cp = 1 sp</td></tr>
              <tr><td><strong>Silver (sp)</strong></td><td>1/10 gp</td><td>10 sp = 1 gp</td></tr>
              <tr><td><strong>Electrum (ep)</strong></td><td>1/2 gp</td><td>2 ep = 1 gp</td></tr>
              <tr><td><strong>Gold (gp)</strong></td><td>1 gp</td><td>1 gp = 1 gp</td></tr>
              <tr><td><strong>Platinum (pp)</strong></td><td>10 gp</td><td>1 pp = 10 gp</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="splitMoneyModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 400px; text-align: center">
        <button class="close-modal-btn" onclick="closeSplitMoneyModal()">&times;</button>
        <h3 class="info-modal-title">Split Loot</h3>
        <p style="font-size: 0.9rem; color: var(--ink-light); margin-bottom: 15px;">Enter total loot found. It will be divided by the party size and added to your current funds.</p>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
          <div class="field"><label class="field-label">CP</label><input type="number" id="splitCp" placeholder="0"></div>
          <div class="field"><label class="field-label">SP</label><input type="number" id="splitSp" placeholder="0"></div>
          <div class="field"><label class="field-label">EP</label><input type="number" id="splitEp" placeholder="0"></div>
          <div class="field"><label class="field-label">GP</label><input type="number" id="splitGp" placeholder="0"></div>
          <div class="field"><label class="field-label">PP</label><input type="number" id="splitPp" placeholder="0"></div>
        </div>
        <div class="field" style="margin-bottom: 20px;">
            <label class="field-label">Party Size (Divide By)</label>
            <input type="number" id="splitPartySize" value="1" min="1" style="text-align: center; font-weight: bold;">
        </div>
        <button class="btn" onclick="applySplitLoot()">Calculate & Add Share</button>
      </div>
    </div>

    <div id="manageMoneyModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 400px; text-align: center">
        <button class="close-modal-btn" onclick="closeManageMoneyModal()">&times;</button>
        <h3 class="info-modal-title">Manage Money</h3>
        <p style="font-size: 0.9rem; color: var(--ink-light); margin-bottom: 15px;">Enter amount to add or spend.</p>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px;">
          <div class="field"><label class="field-label">CP</label><input type="number" id="manageCp" placeholder="0"></div>
          <div class="field"><label class="field-label">SP</label><input type="number" id="manageSp" placeholder="0"></div>
          <div class="field"><label class="field-label">EP</label><input type="number" id="manageEp" placeholder="0"></div>
          <div class="field"><label class="field-label">GP</label><input type="number" id="manageGp" placeholder="0"></div>
          <div class="field"><label class="field-label">PP</label><input type="number" id="managePp" placeholder="0"></div>
        </div>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="btn" onclick="applyMoneyChange(1)" style="flex: 1; background: linear-gradient(135deg, #27ae60 0%, #145a32 100%);">Gain (+)</button>
            <button class="btn" onclick="applyMoneyChange(-1)" style="flex: 1; background: linear-gradient(135deg, #c0392b 0%, #922b21 100%);">Spend (-)</button>
        </div>
      </div>
    </div>

    <div id="expModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 300px; text-align: center">
        <h3 class="info-modal-title">Add Experience</h3>
        <div style="margin-bottom: 10px;">
            <label class="field-label" style="display:block; margin-bottom:4px;">Total XP</label>
            <input type="number" id="expTotalInput" placeholder="Total Amount" style="background: white; border: 1px solid var(--gold); padding: 8px; text-align: center; width: 100%;"/>
        </div>
        <div style="margin-bottom: 16px;">
            <label class="field-label" style="display:block; margin-bottom:4px;">Split By (Players)</label>
            <input type="number" id="expPartySize" value="1" min="1" style="background: white; border: 1px solid var(--gold); padding: 8px; text-align: center; width: 100%;"/>
        </div>
        <div style="display: flex; gap: 10px; justify-content: center">
          <button id="confirmExp" class="btn" style="padding: 8px 16px">Add Share</button>
          <button id="cancelExp" class="btn btn-secondary" style="padding: 8px 16px">Cancel</button>
        </div>
      </div>
    </div>

    <div id="lastSavedModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 600px; display: flex; flex-direction: column; height: 80vh;">
        <button class="close-modal-btn" onclick="document.getElementById('lastSavedModal').style.display = 'none'">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Last Saved Data</h3>
        <p style="font-size: 0.9rem; color: var(--ink-light); margin-bottom: 10px;">This is the raw data currently stored in your browser. You can copy this as a backup or paste valid JSON here to restore.</p>
        <textarea id="lastSavedTextarea" style="flex: 1; font-family: monospace; font-size: 0.85rem; padding: 10px; border: 1px solid var(--gold); border-radius: 4px; resize: none; background: white; margin-bottom: 15px; overflow-y: auto;"></textarea>
        <div style="text-align: center; display: flex; gap: 10px; justify-content: center;">
            <button class="btn" onclick="restoreFromModal()">Load / Restore</button>
            <button class="btn btn-secondary" onclick="copyLastSaved()">Copy to Clipboard</button>
        </div>
      </div>
    </div>

    <div id="xpTableModal" class="info-modal-overlay" onclick="closeXpTableModal(event)">
      <div class="info-modal-content" style="max-width: 400px; max-height: 80vh; overflow-y: auto;">
        <button class="close-modal-btn" onclick="document.getElementById('xpTableModal').style.display = 'none'">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Leveling Thresholds</h3>
        <div id="xpTableContent" class="info-modal-text">
        </div>
      </div>
    </div>

    <div id="weaponPickerModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 500px; max-height: 80vh; display: flex; flex-direction: column;">
        <button class="close-modal-btn" onclick="closeWeaponPicker()">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Select a Weapon</h3>
        <div style="margin-bottom: 10px; display: flex; gap: 8px">
          <input type="text" id="weaponSearch" placeholder="Search weapons..." onkeyup="filterWeaponPicker()" style="border: 1px solid var(--gold); padding: 8px; border-radius: 4px;"/>
        </div>
        <div id="weaponPickerList" class="checklist-grid" style="grid-template-columns: 1fr; flex: 1; overflow-y: auto"></div>
        <div style="margin-top: 10px; border-top: 1px solid var(--gold); padding-top: 10px; text-align: center;">
          <p style="font-size: 0.8rem; color: var(--ink-light); margin-bottom: 8px;">Don't see it? Add custom.</p>
          <button class="btn btn-secondary" onclick="selectCustomWeapon()">Use Custom Name</button>
        </div>
      </div>
    </div>

    <div id="itemSearchModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 600px; max-height: 80vh; display: flex; flex-direction: column;">
        <button class="close-modal-btn" onclick="closeItemSearch()">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Search Items from Zip</h3>
        <div style="margin-bottom: 10px;">
          <input type="text" id="itemSearchInput" placeholder="Search items..." onkeyup="filterItemSearch()" style="border: 1px solid var(--gold); padding: 8px; border-radius: 4px; width: 100%;"/>
        </div>
        <div id="itemSearchList" class="checklist-grid" style="grid-template-columns: 1fr; flex: 1; overflow-y: auto; gap: 8px;"></div>
        <div id="itemSearchPagination" style="display: flex; justify-content: center; gap: 10px; margin-top: 10px; align-items: center; border-top: 1px solid var(--gold); padding-top: 10px;">
            <button class="btn btn-secondary" onclick="changeItemSearchPage(-1)" style="padding: 4px 10px; font-size: 0.8rem;">Prev</button>
            <span id="itemSearchPageInfo" style="font-family: 'Cinzel', serif; font-size: 0.9rem;">Page 1</span>
            <button class="btn btn-secondary" onclick="changeItemSearchPage(1)" style="padding: 4px 10px; font-size: 0.8rem;">Next</button>
        </div>
      </div>
    </div>

    <div id="spellSearchModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 600px; max-height: 80vh; display: flex; flex-direction: column;">
        <button class="close-modal-btn" onclick="closeSpellSearch()">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Search Spells from Zip</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
            <select id="spellSearchClass" class="styled-select" onchange="filterSpellSearch()">
                <option value="">All Classes</option>
            </select>
            <select id="spellSearchLevel" class="styled-select" onchange="filterSpellSearch()">
                <option value="">All Levels</option>
                <option value="0">Cantrip</option>
                <option value="1">Level 1</option>
                <option value="2">Level 2</option>
                <option value="3">Level 3</option>
                <option value="4">Level 4</option>
                <option value="5">Level 5</option>
                <option value="6">Level 6</option>
                <option value="7">Level 7</option>
                <option value="8">Level 8</option>
                <option value="9">Level 9</option>
            </select>
        </div>
        <div style="display: flex; gap: 8px; margin-bottom: 10px;">
             <input type="text" id="spellSearchInput" placeholder="Search spells..." onkeyup="filterSpellSearch()" style="border: 1px solid var(--gold); padding: 8px; border-radius: 4px; flex: 1;"/>
             <select id="spellSearchSort" class="styled-select" onchange="filterSpellSearch()" style="width: 130px;">
                <option value="name-asc">Name A-Z</option>
                <option value="name-desc">Name Z-A</option>
                <option value="level-asc">Level Low-High</option>
                <option value="level-desc">Level High-Low</option>
            </select>
        </div>
        <div id="spellSearchList" class="checklist-grid" style="grid-template-columns: 1fr; flex: 1; overflow-y: auto; gap: 8px;"></div>
        <div id="spellSearchPagination" style="display: flex; justify-content: center; gap: 10px; margin-top: 10px; align-items: center; border-top: 1px solid var(--gold); padding-top: 10px;">
            <button class="btn btn-secondary" onclick="changeSpellSearchPage(-1)" style="padding: 4px 10px; font-size: 0.8rem;">Prev</button>
            <span id="spellSearchPageInfo" style="font-family: 'Cinzel', serif; font-size: 0.9rem;">Page 1</span>
            <button class="btn btn-secondary" onclick="changeSpellSearchPage(1)" style="padding: 4px 10px; font-size: 0.8rem;">Next</button>
        </div>
      </div>
    </div>

    <div id="conditionModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 500px; max-height: 85vh; display: flex; flex-direction: column;">
        <button class="close-modal-btn" onclick="closeConditionModal()">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Conditions</h3>
        <div id="conditionListContainer" class="checklist-grid" style="grid-template-columns: 1fr; flex: 1; overflow-y: auto; gap: 8px;"></div>
        <div style="text-align: center; margin-top: 16px; border-top: 1px solid var(--gold); padding-top: 10px;">
          <button class="btn" onclick="closeConditionModal()">Done</button>
        </div>
      </div>
    </div>

    <div id="masteryModal" class="info-modal-overlay" onclick="closeMasteryModal(event)">
      <div class="info-modal-content" style="max-width: 500px">
        <button class="close-modal-btn" onclick="document.getElementById('masteryModal').style.display = 'none'">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Weapon Mastery Properties</h3>
        <div class="ref-box" style="max-height: 60vh; font-size: 0.95rem">
          <div style="margin-bottom: 8px"><span class="ref-title">Cleave</span> <strong>Prerequisite:</strong> Melee Weapon, Heavy or Versatile. Hit creature -> 2nd attack vs different creature within 5ft. On hit, 2nd takes damage = ability mod.</div>
           <div style="margin-bottom: 8px"><span class="ref-title">Graze</span> <strong>Prerequisite:</strong> Melee, Heavy or Versatile. Miss -> deal damage = ability mod.</div>
           <div style="margin-bottom: 8px"><span class="ref-title">Nick</span> <strong>Prerequisite:</strong> Light. Extra attack from Light prop is part of Action, not Bonus.</div>
           <div style="margin-bottom: 8px"><span class="ref-title">Push</span> <strong>Prerequisite:</strong> Heavy, Two-Handed, or Versatile. Hit -> push 10ft away.</div>
           <div style="margin-bottom: 8px"><span class="ref-title">Sap</span> <strong>Prerequisite:</strong> Versatile or none. Hit -> target has Disadv on next attack.</div>
           <div style="margin-bottom: 8px"><span class="ref-title">Slow</span> <strong>Prerequisite:</strong> None. Hit -> Speed -10ft.</div>
           <div style="margin-bottom: 8px"><span class="ref-title">Topple</span> <strong>Prerequisite:</strong> Heavy, Reach, or Versatile. Hit -> Con save or Prone.</div>
           <div style="margin-bottom: 8px"><span class="ref-title">Vex</span> <strong>Prerequisite:</strong> Ammunition, Finesse, or Light. Hit & dmg -> Adv on next attack vs target.</div>
        </div>
      </div>
    </div>

    <div id="themeModal" class="info-modal-overlay" onclick="closeThemeModal(event)">
      <div class="info-modal-content" style="max-width: 600px">
        <button class="close-modal-btn" onclick="document.getElementById('themeModal').style.display = 'none'">&times;</button>
        <h3 class="info-modal-title" style="text-align: center">Select Class Theme</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">
          <button class="btn btn-secondary" onclick="setTheme('')" style="border: 1px solid var(--ink)">Default</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-artificer')" style="background: #008080">Artificer</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-barbarian')" style="background: #c0392b">Barbarian</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-bard')" style="background: #8e44ad">Bard</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-cleric')" style="background: #7f8c8d">Cleric</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-druid')" style="background: #2d6a4f">Druid</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-fighter')" style="background: #922b21">Fighter</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-monk')" style="background: #27ae60">Monk</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-paladin')" style="background: #283747">Paladin</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-ranger')" style="background: #355e3b">Ranger</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-rogue')" style="background: #212f3c">Rogue</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-sorcerer')" style="background: #d35400">Sorcerer</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-warlock')" style="background: #4a148c">Warlock</button>
          <button class="btn btn-secondary" onclick="setTheme('theme-wizard')" style="background: #1f3a93">Wizard</button>
        </div>
      </div>
    </div>

    <div id="alignModal" class="info-modal-overlay">
      <div class="info-modal-content" style="max-width: 340px; text-align: center">
        <h3 class="info-modal-title">Select Alignment</h3>
        <div class="alignment-grid">
          <div class="alignment-option" onclick="setAlignment('Lawful Good')">Lawful Good</div>
          <div class="alignment-option" onclick="setAlignment('Neutral Good')">Neutral Good</div>
          <div class="alignment-option" onclick="setAlignment('Chaotic Good')">Chaotic Good</div>
          <div class="alignment-option" onclick="setAlignment('Lawful Neutral')">Lawful Neutral</div>
          <div class="alignment-option" onclick="setAlignment('True Neutral')">True Neutral</div>
          <div class="alignment-option" onclick="setAlignment('Chaotic Neutral')">Chaotic Neutral</div>
          <div class="alignment-option" onclick="setAlignment('Lawful Evil')">Lawful Evil</div>
          <div class="alignment-option" onclick="setAlignment('Neutral Evil')">Neutral Evil</div>
          <div class="alignment-option" onclick="setAlignment('Chaotic Evil')">Chaotic Evil</div>
        </div>
        <button id="cancelAlign" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </body>
</html>